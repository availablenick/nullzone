%nav.localization
  = link_to 'Início', main_path
  >

%div.section-description
  %h2
    %b Área geral

  %p
    Só lorotas

- if @topicos.any?
  - page_number = 1
  - if params[:page]
    - page_number = params[:page].to_i

  %div.before-stack
    = render 'page_buttons', current_page: page_number, thread_type: 'list', source: @topicos

  - items_per_page = 10
  - begin_index = (page_number-1) * items_per_page
  - topicos_array = @topicos.slice(begin_index, items_per_page)

  %div.thread-stack
    %div

    - topicos_array.each do |topico|
      %div.thread
        %div.left
          %div
            %a{ href: usuario_path(topico.usuario) }
              = set_avatar(topico.usuario)

          %div
            %div
              = link_to topico.titulo, topico_path(topico)
              %br/
              %b
                = link_to topico.usuario.login, usuario_path(topico.usuario)
              %br/

              - posts_per_page = 10
              - num_posts = topico.posts.count + 1
              - page_amount = (num_posts.to_f / posts_per_page).ceil

              %div.bottom
                = format_date(topico.created_at)

                - if page_amount > 1
                  %div
                    - if page_amount > 6
                      - (1..3).each do |i|
                        = link_to i, topico_path(topico, page: i)

                      %b= '. . .'

                      - ((page_amount-1)..page_amount).each do |i|
                        = link_to i, topico_path(topico, page: i)

                    - else
                      - (1..page_amount).each do |i|
                        = link_to i, topico_path(topico, page: i)

        %div.middle
          = topico.posts.count
          respostas

        %div.right
          %div
            - post = nil
            - num = 1 + topico.posts.count / 10
            - if topico.posts.any?
              - user = topico.posts.last.usuario
              - date = topico.posts.last.created_at
              - post = topico.posts.last
            - else
              - user = topico.usuario
              - date = topico.created_at

            Última mensagem:
            %br/
            = format_date(date, true)
            %br/
            Por:
            %b
              = link_to user.login, topico_path(topico, page: num, anchor: "#{topico.posts.count}" )

  %div.after-stack
    = render 'page_buttons', current_page: page_number, thread_type: 'list', source: @topicos

    - if current_user
      %div.new-thread
        = link_to new_topico_path do
          %i.fas.fa-plus
          Novo tópico

    - else
      %div{ style: "color: white; text-align: center" }
        Você precisa logar para criar um tópico.

- else
  %div.after-stack
    %p
      - if params[:query] && params[:query] != nil
        Nenhum tópico encontrado
      - else
        Nenhum tópico criado

    - if current_user
      %div.new-thread
        = link_to new_topico_path do
          %i.fas.fa-plus
          Novo tópico

    - else
      %div{ style: "color: white; text-align: center" }
        Você precisa logar para criar um tópico.
