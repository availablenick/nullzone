- case thread_type
  - when 'single'
    - action = :show
    - items_amount = source.count + 1
  - when 'list'
    - action = :index
    - items_amount = source.count
  - when 'search'
    - action = :search
    - items_amount = source.count

- items_per_page = 10
- pages_amount = (items_amount.to_f / items_per_page).ceil

- if pages_amount > 1
  %div.page-buttons
    -# 'Previous page' button
    - if current_page > 1
      = link_to '&#9666;'.html_safe, action: action, controller: 'topics', page: current_page-1, query: params[:query]
      %span

    -# Buttons from first to current
    - surrounding_pages = 2
    - first_and_last_page_offset = 5

    - if current_page < 1 + first_and_last_page_offset
      - (1..current_page).each do |i|
        - btn_class = nil
        - if i == current_page
          - btn_class = 'selected-page'

        = link_to i, { action: action, controller: 'topics', page: i, query: params[:query] }, class: btn_class
        - if !btn_class || i != pages_amount
          %span

    - else
      = link_to 1, action: action, controller: 'topics', page: 1, query: params[:query]
      %span

      = link_to 2, action: action, controller: 'topics', page: 2, query: params[:query]
      %span

      = link_to '...'
      %span

      - ((current_page - surrounding_pages)..current_page).each do |i|
        - btn_class = nil
        - if i == current_page
          - btn_class = 'selected-page'

        = link_to i, { action: action, controller: 'topics', page: i, query: params[:query] }, class: btn_class
        - if !btn_class || i != pages_amount
          %span


    -# Buttons from current + 1 to last
    - if current_page > pages_amount - first_and_last_page_offset
      - ((current_page + 1)..pages_amount).each do |i|
        - btn_class = nil
        - if i == current_page
          - btn_class = 'selected-page'

        = link_to i, { action: action, controller: 'topics', page: i, query: params[:query] }, class: btn_class
        - if !btn_class || i != pages_amount
          %span

    - else
      - ((current_page + 1)..(current_page + surrounding_pages)).each do |i|
        - btn_class = nil
        - if i == current_page
          - btn_class = 'selected-page'

        = link_to i, { action: action, controller: 'topics', page: i, query: params[:query] }, class: btn_class
        - if !btn_class || i != pages_amount
          %span

      = link_to '...'
      %span

      = link_to pages_amount - 1, action: action, controller: 'topics', page: pages_amount - 1, query: params[:query]
      %span

      = link_to pages_amount, action: action, controller: 'topics', page: pages_amount, query: params[:query]
      %span

    -# 'Next page' button
    - if current_page < pages_amount
      = link_to '&#9656;'.html_safe, action: action, controller: 'topics', page: current_page-1, query: params[:query]
